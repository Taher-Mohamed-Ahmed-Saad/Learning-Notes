{"version":3,"sources":["../../server/post-process.ts"],"names":["optimizeAmp","getFontDefinitionFromManifest","process","env","NEXT_RUNTIME","require","default","middlewareRegistry","registerPostProcessor","name","middleware","condition","push","processHTML","html","data","options","root","parse","document","callMiddleWare","inspectData","inspect","mutate","i","length","FontOptimizerMiddleware","originalDom","getFontDefinition","fontDefinitions","querySelectorAll","filter","tag","getAttribute","hasAttribute","OPTIMIZED_FONT_PROVIDERS","some","url","dataHref","startsWith","forEach","element","nonce","markup","result","preconnectUrls","Set","fontDef","fallBackLinkTag","indexOf","fontContent","replace","nonceStr","escapedUrl","fontRegex","RegExp","provider","find","p","add","preconnect","preconnectTag","postProcessHTML","pathname","content","renderOpts","inAmpMode","hybridAmp","postProcessors","ampOptimizerConfig","ampSkipValidation","ampValidator","__NEXT_OPTIMIZE_FONTS","fontManifest","optimizeFonts","optimizeCss","Critters","cssOptimizer","ssrMode","reduceInlineStyles","path","distDir","publicPath","assetPrefix","preload","fonts","nonNullable","postProcessor"],"mappings":"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"}