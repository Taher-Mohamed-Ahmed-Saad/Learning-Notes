{"version":3,"sources":["../../../client/components/reducer.ts"],"names":["reducer","fillCacheWithNewSubTreeData","newCache","existingCache","flightDataPath","isLastEntry","length","parallelRouteKey","segment","segmentForCache","Array","isArray","existingChildSegmentMap","parallelRoutes","get","childSegmentMap","Map","set","existingChildCacheNode","childCacheNode","data","subTreeData","slice","fillCacheWithDataProperty","segments","fetchResponse","bailOptimistic","createOptimisticTree","flightRouterState","isFirstSegment","parentRefetch","href","existingSegment","existingParallelRoutes","isLastSegment","shouldRefetchThisLevel","matchSegment","childTree","childItem","children","result","walkTreeWithFlightDataPath","flightSegmentPath","treePatch","url","currentSegment","Error","lastSegment","tree","push","state","action","type","historyState","payload","pathname","search","hash","canonicalUrl","pushRef","cache","cacheType","navigateType","mutable","pendingPush","split","optimisticTree","mpaNavigation","patchedTree","JSON","stringify","previousTree","isOptimistic","res","fetchServerResponse","flightData","readRoot","treePath","newTree","console","log"],"mappings":"AAAA;;;;QA2PgBA,OAAO,GAAPA,OAAO;AArPM,IAAA,cAAkB,WAAlB,kBAAkB,CAAA;AACX,IAAA,gBAAqB,WAArB,qBAAqB,CAAA;;;;;;;;;;;;;;;AAEzD,MAAMC,2BAA2B,GAAG,CAClCC,QAAmB,EACnBC,aAAwB,EACxBC,cAA8B,GAC3B;IACH,oDAAoD;IACpD,MAAMC,WAAW,GAAGD,cAAc,CAACE,MAAM,IAAI,CAAC;IAC9C,MAAM,CAACC,gBAAgB,EAAEC,OAAO,CAAC,GAAGJ,cAAc;IAElD,MAAMK,eAAe,GAAGC,KAAK,CAACC,OAAO,CAACH,OAAO,CAAC,GAAGA,OAAO,CAAC,CAAC,CAAC,GAAGA,OAAO;IAErE,MAAMI,uBAAuB,GAC3BT,aAAa,CAACU,cAAc,CAACC,GAAG,CAACP,gBAAgB,CAAC;IAEpD,IAAI,CAACK,uBAAuB,EAAE;QAC5B,6EAA6E;QAC7E,sEAAsE;QACtE,OAAM;KACP;IAED,IAAIG,eAAe,GAAGb,QAAQ,CAACW,cAAc,CAACC,GAAG,CAACP,gBAAgB,CAAC;IACnE,IAAI,CAACQ,eAAe,IAAIA,eAAe,KAAKH,uBAAuB,EAAE;QACnEG,eAAe,GAAG,IAAIC,GAAG,CAACJ,uBAAuB,CAAC;QAClDV,QAAQ,CAACW,cAAc,CAACI,GAAG,CAACV,gBAAgB,EAAEQ,eAAe,CAAC;KAC/D;IAED,MAAMG,sBAAsB,GAAGN,uBAAuB,CAACE,GAAG,CAACL,eAAe,CAAC;IAC3E,IAAIU,cAAc,GAAGJ,eAAe,CAACD,GAAG,CAACL,eAAe,CAAC;IAEzD,yFAAyF;IACzF,IAAIJ,WAAW,EAAE;QACf,IACE,CAACc,cAAc,IACf,CAACA,cAAc,CAACC,IAAI,IACpBD,cAAc,KAAKD,sBAAsB,EACzC;YACAH,eAAe,CAACE,GAAG,CAACR,eAAe,EAAE;gBACnCW,IAAI,EAAE,IAAI;gBACVC,WAAW,EAAEjB,cAAc,CAAC,CAAC,CAAC;gBAC9BS,cAAc,EAAE,IAAIG,GAAG,EAAE;aAC1B,CAAC;SACH;QACD,OAAM;KACP;IAED,IAAI,CAACG,cAAc,IAAI,CAACD,sBAAsB,EAAE;QAC9C,6EAA6E;QAC7E,sEAAsE;QACtE,OAAM;KACP;IAED,IAAIC,cAAc,KAAKD,sBAAsB,EAAE;QAC7CC,cAAc,GAAG;YACfC,IAAI,EAAED,cAAc,CAACC,IAAI;YACzBC,WAAW,EAAEF,cAAc,CAACE,WAAW;YACvCR,cAAc,EAAE,IAAIG,GAAG,CAACG,cAAc,CAACN,cAAc,CAAC;SACvD;QACDE,eAAe,CAACE,GAAG,CAACR,eAAe,EAAEU,cAAc,CAAC;KACrD;IAEDlB,2BAA2B,CACzBkB,cAAc,EACdD,sBAAsB,EACtBd,cAAc,CAACkB,KAAK,CAAC,CAAC,CAAC,CACxB;CACF;AAED,MAAMC,yBAAyB,GAAG,CAChCrB,QAAmB,EACnBC,aAAwB,EACxBqB,QAAkB,EAClBC,aAAkB,GAC0B;IAC5C,MAAMpB,WAAW,GAAGmB,QAAQ,CAAClB,MAAM,KAAK,CAAC;IAEzC,MAAMC,gBAAgB,GAAG,UAAU;IACnC,MAAM,CAACC,OAAO,CAAC,GAAGgB,QAAQ;IAE1B,MAAMZ,uBAAuB,GAC3BT,aAAa,CAACU,cAAc,CAACC,GAAG,CAACP,gBAAgB,CAAC;IAEpD,IAAI,CAACK,uBAAuB,EAAE;QAC5B,6EAA6E;QAC7E,sEAAsE;QACtE,OAAO;YAAEc,cAAc,EAAE,IAAI;SAAE,CAAA;KAChC;IAED,IAAIX,eAAe,GAAGb,QAAQ,CAACW,cAAc,CAACC,GAAG,CAACP,gBAAgB,CAAC;IAEnE,IAAI,CAACQ,eAAe,IAAIA,eAAe,KAAKH,uBAAuB,EAAE;QACnEG,eAAe,GAAG,IAAIC,GAAG,CAACJ,uBAAuB,CAAC;QAClDV,QAAQ,CAACW,cAAc,CAACI,GAAG,CAACV,gBAAgB,EAAEQ,eAAe,CAAC;KAC/D;IAED,MAAMG,sBAAsB,GAAGN,uBAAuB,CAACE,GAAG,CAACN,OAAO,CAAC;IACnE,IAAIW,cAAc,GAAGJ,eAAe,CAACD,GAAG,CAACN,OAAO,CAAC;IAEjD,yFAAyF;IACzF,IAAIH,WAAW,EAAE;QACf,IACE,CAACc,cAAc,IACf,CAACA,cAAc,CAACC,IAAI,IACpBD,cAAc,KAAKD,sBAAsB,EACzC;YACAH,eAAe,CAACE,GAAG,CAACT,OAAO,EAAE;gBAC3BY,IAAI,EAAEK,aAAa,EAAE;gBACrBJ,WAAW,EAAE,IAAI;gBACjBR,cAAc,EAAE,IAAIG,GAAG,EAAE;aAC1B,CAAC;SACH;QACD,OAAM;KACP;IAED,IAAI,CAACG,cAAc,IAAI,CAACD,sBAAsB,EAAE;QAC9C,+EAA+E;QAC/E,IAAI,CAACC,cAAc,EAAE;YACnBJ,eAAe,CAACE,GAAG,CAACT,OAAO,EAAE;gBAC3BY,IAAI,EAAEK,aAAa,EAAE;gBACrBJ,WAAW,EAAE,IAAI;gBACjBR,cAAc,EAAE,IAAIG,GAAG,EAAE;aAC1B,CAAC;SACH;QACD,OAAM;KACP;IAED,IAAIG,cAAc,KAAKD,sBAAsB,EAAE;QAC7CC,cAAc,GAAG;YACfC,IAAI,EAAED,cAAc,CAACC,IAAI;YACzBC,WAAW,EAAEF,cAAc,CAACE,WAAW;YACvCR,cAAc,EAAE,IAAIG,GAAG,CAACG,cAAc,CAACN,cAAc,CAAC;SACvD;QACDE,eAAe,CAACE,GAAG,CAACT,OAAO,EAAEW,cAAc,CAAC;KAC7C;IAED,OAAOI,yBAAyB,CAC9BJ,cAAc,EACdD,sBAAsB,EACtBM,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,EACjBG,aAAa,CACd,CAAA;CACF;AAED,MAAME,oBAAoB,GAAG,CAC3BH,QAAkB,EAClBI,iBAA2C,EAC3CC,cAAuB,EACvBC,aAAsB,EACtBC,IAAa,GACS;IACtB,MAAM,CAACC,eAAe,EAAEC,sBAAsB,CAAC,GAAGL,iBAAiB,IAAI;QACrE,IAAI;QACJ,EAAE;KACH;IACD,MAAMpB,OAAO,GAAGgB,QAAQ,CAAC,CAAC,CAAC;IAC3B,MAAMU,aAAa,GAAGV,QAAQ,CAAClB,MAAM,KAAK,CAAC;IAE3C,MAAM6B,sBAAsB,GAC1B,CAACP,iBAAiB,IAAIpB,OAAO,KAAKoB,iBAAiB,CAAC,CAAC,CAAC;IAExD,IAAIf,cAAc,GAAyB,EAAE;IAC7C,IAAImB,eAAe,KAAK,IAAI,IAAII,CAAAA,GAAAA,cAAY,AAA0B,CAAA,aAA1B,CAACJ,eAAe,EAAExB,OAAO,CAAC,EAAE;QACtEK,cAAc,GAAGoB,sBAAsB;KACxC;IAED,IAAII,SAAS;IACb,IAAI,CAACH,aAAa,EAAE;QAClB,MAAMI,SAAS,GAAGX,oBAAoB,CACpCH,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,EACjBT,cAAc,GAAGA,cAAc,CAAC0B,QAAQ,GAAG,IAAI,EAC/C,KAAK,EACLT,aAAa,IAAIK,sBAAsB,CACxC;QAEDE,SAAS,GAAGC,SAAS;KACtB;IAED,MAAME,MAAM,GAAsB;QAChChC,OAAO;QACP,aACKK,cAAc,EACbwB,SAAS,GAAG;YAAEE,QAAQ,EAAEF,SAAS;SAAE,GAAG,EAAE,CAC7C;KACF;IAED,IAAI,CAACP,aAAa,IAAIK,sBAAsB,EAAE;QAC5CK,MAAM,CAAC,CAAC,CAAC,GAAG,SAAS;KACtB;IAED,wBAAwB;IACxB,IAAIX,cAAc,EAAE;QAClBW,MAAM,CAAC,CAAC,CAAC,GAAGT,IAAI;KACjB;IAED,OAAOS,MAAM,CAAA;CACd;AAED,MAAMC,0BAA0B,GAAG,CACjCC,iBAAgC,EAChCd,iBAAoC,EACpCe,SAA4B,GACN;IACtB,MAAM,CAACnC,OAAO,EAAEK,cAAc,EAAE+B,GAAG,CAAC,GAAGhB,iBAAiB;IACxD,MAAM,CAACiB,cAAc,EAAEtC,gBAAgB,CAAC,GAAGmC,iBAAiB;IAE5D,iGAAiG;IACjG,eAAe;IACf,IAAI,CAACN,CAAAA,GAAAA,cAAY,AAAyB,CAAA,aAAzB,CAACS,cAAc,EAAErC,OAAO,CAAC,EAAE;QAC1C,MAAM,IAAIsC,KAAK,CAAC,kBAAkB,CAAC,CAAA;KACpC;IAED,MAAMC,WAAW,GAAGL,iBAAiB,CAACpC,MAAM,KAAK,CAAC;IAElD,MAAM0C,IAAI,GAAsB;QAC9BN,iBAAiB,CAAC,CAAC,CAAC;QACpB,aACK7B,cAAc;YACjB,CAACN,gBAAgB,CAAC,EAAEwC,WAAW,GAC3BJ,SAAS,GACTF,0BAA0B,CACxBC,iBAAiB,CAACpB,KAAK,CAAC,CAAC,CAAC,EAC1BT,cAAc,CAACN,gBAAgB,CAAC,EAChCoC,SAAS,CACV;UACN;KACF;IAED,IAAIC,GAAG,EAAE;QACPI,IAAI,CAACC,IAAI,CAACL,GAAG,CAAC;KACf;IAED,OAAOI,IAAI,CAAA;CACZ;AAWM,SAAShD,OAAO,CACrBkD,KAAqB,EACrBC,MAsBK,EACW;IAChB,IAAIA,MAAM,CAACC,IAAI,KAAK,SAAS,EAAE;QAC7B,MAAM,EAAER,GAAG,CAAA,EAAES,YAAY,CAAA,EAAE,GAAGF,MAAM,CAACG,OAAO;QAC5C,MAAMvB,IAAI,GAAGa,GAAG,CAACW,QAAQ,GAAGX,GAAG,CAACY,MAAM,GAAGZ,GAAG,CAACa,IAAI;QAEjD,OAAO;YACLC,YAAY,EAAE3B,IAAI;YAClB4B,OAAO,EAAET,KAAK,CAACS,OAAO;YACtBC,KAAK,EAAEV,KAAK,CAACU,KAAK;YAClBZ,IAAI,EAAEK,YAAY,CAACL,IAAI;SACxB,CAAA;KACF;IAED,IAAIG,MAAM,CAACC,IAAI,KAAK,UAAU,EAAE;QAC9B,MAAM,EAAER,GAAG,CAAA,EAAEiB,SAAS,CAAA,EAAEC,YAAY,CAAA,EAAEF,KAAK,CAAA,EAAEG,OAAO,CAAA,EAAE,GAAGZ,MAAM,CAACG,OAAO;QACvE,MAAMU,WAAW,GAAGF,YAAY,KAAK,MAAM,GAAG,IAAI,GAAG,KAAK;QAC1D,MAAM,EAAEP,QAAQ,CAAA,EAAE,GAAGX,GAAG;QACxB,MAAMb,IAAI,GAAGa,GAAG,CAACW,QAAQ,GAAGX,GAAG,CAACY,MAAM,GAAGZ,GAAG,CAACa,IAAI;QAEjD,MAAMjC,QAAQ,GAAG+B,QAAQ,CAACU,KAAK,CAAC,GAAG,CAAC;QACpC,oDAAoD;QACpDzC,QAAQ,CAACyB,IAAI,CAAC,EAAE,CAAC;QAEjB,sFAAsF;QACtF,IAAIY,SAAS,KAAK,MAAM,EAAE;YACxB,MAAMK,cAAc,GAAGvC,oBAAoB,CACzCH,QAAQ,EACR0B,KAAK,CAACF,IAAI,EACV,IAAI,EACJ,KAAK,EACLjB,IAAI,CACL;YAED,OAAO;gBACL2B,YAAY,EAAE3B,IAAI;gBAClB4B,OAAO,EAAE;oBAAEK,WAAW;oBAAEG,aAAa,EAAE,KAAK;iBAAE;gBAC9CP,KAAK,EAAEV,KAAK,CAACU,KAAK;gBAClBZ,IAAI,EAAEkB,cAAc;aACrB,CAAA;SACF;QAED,kFAAkF;QAClF,gGAAgG;QAChG,mHAAmH;QACnH,IAAIL,SAAS,KAAK,MAAM,EAAE;YACxB,IACEE,OAAO,CAACK,WAAW,IACnBC,IAAI,CAACC,SAAS,CAACP,OAAO,CAACQ,YAAY,CAAC,KAAKF,IAAI,CAACC,SAAS,CAACpB,KAAK,CAACF,IAAI,CAAC,EACnE;gBACA,OAAO;oBACLU,YAAY,EAAE3B,IAAI;oBAClB4B,OAAO,EAAE;wBAAEK,WAAW;wBAAEG,aAAa,EAAE,KAAK;qBAAE;oBAC9CP,KAAK,EAAEA,KAAK;oBACZZ,IAAI,EAAEe,OAAO,CAACK,WAAW;iBAC1B,CAAA;aACF;YAED,sFAAsF;YACtF,MAAMI,YAAY,GAAG,KAAK;YAE1B,IAAIA,YAAY,EAAE;gBAChB,wBAAwB;gBACxB,kGAAkG;gBAClG,MAAMN,cAAc,GAAGvC,oBAAoB,CACzCH,QAAQ,EACR0B,KAAK,CAACF,IAAI,EACV,IAAI,EACJ,KAAK,EACLjB,IAAI,CACL;gBAED,4DAA4D;gBAC5D,sEAAsE;gBACtE,MAAM0C,GAAG,GAAGlD,yBAAyB,CACnCqC,KAAK,EACLV,KAAK,CAACU,KAAK,EACXpC,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,EACjB,IAAM;oBACJ,OAAOoD,CAAAA,GAAAA,gBAAmB,AAAqB,CAAA,oBAArB,CAAC9B,GAAG,EAAEsB,cAAc,CAAC,CAAA;iBAChD,CACF;gBAED,IAAI,CAACO,CAAAA,GAAG,QAAgB,GAAnBA,KAAAA,CAAmB,GAAnBA,GAAG,CAAE/C,cAAc,CAAA,EAAE;oBACxBqC,OAAO,CAACQ,YAAY,GAAGrB,KAAK,CAACF,IAAI;oBACjCe,OAAO,CAACK,WAAW,GAAGF,cAAc;oBACpC,OAAO;wBACLR,YAAY,EAAE3B,IAAI;wBAClB4B,OAAO,EAAE;4BAAEK,WAAW;4BAAEG,aAAa,EAAE,KAAK;yBAAE;wBAC9CP,KAAK,EAAEA,KAAK;wBACZZ,IAAI,EAAEkB,cAAc;qBACrB,CAAA;iBACF;aACF;YAED,IAAI,CAACN,KAAK,CAACxC,IAAI,EAAE;gBACfwC,KAAK,CAACxC,IAAI,GAAGsD,CAAAA,GAAAA,gBAAmB,AAAiB,CAAA,oBAAjB,CAAC9B,GAAG,EAAEM,KAAK,CAACF,IAAI,CAAC;aAClD;YACD,MAAM2B,UAAU,GAAGf,KAAK,CAACxC,IAAI,CAACwD,QAAQ,EAAE;YAExC,4DAA4D;YAC5D,IAAI,OAAOD,UAAU,KAAK,QAAQ,EAAE;gBAClC,OAAO;oBACLjB,YAAY,EAAEiB,UAAU;oBACxBhB,OAAO,EAAE;wBAAEK,WAAW,EAAE,IAAI;wBAAEG,aAAa,EAAE,IAAI;qBAAE;oBACnDP,KAAK,EAAEV,KAAK,CAACU,KAAK;oBAClBZ,IAAI,EAAEE,KAAK,CAACF,IAAI;iBACjB,CAAA;aACF;YAEDY,KAAK,CAACxC,IAAI,GAAG,IAAI;YAEjB,6DAA6D;YAC7D,MAAMhB,cAAc,GAAGuE,UAAU,CAAC,CAAC,CAAC;YAEpC,MAAM,CAAChC,SAAS,CAAC,GAAGvC,cAAc,CAACkB,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5C,MAAMuD,QAAQ,GAAGzE,cAAc,CAACkB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC5C,MAAMwD,OAAO,GAAGrC,0BAA0B,CACxC,kBAAkB;YAClB;gBAAC,EAAE;mBAAKoC,QAAQ;aAAC,EACjB3B,KAAK,CAACF,IAAI,EACVL,SAAS,CACV;YAEDoB,OAAO,CAACQ,YAAY,GAAGrB,KAAK,CAACF,IAAI;YACjCe,OAAO,CAACK,WAAW,GAAGU,OAAO;YAE7B7E,2BAA2B,CAAC2D,KAAK,EAAEV,KAAK,CAACU,KAAK,EAAExD,cAAc,CAAC;YAE/D,OAAO;gBACLsD,YAAY,EAAE3B,IAAI;gBAClB4B,OAAO,EAAE;oBAAEK,WAAW;oBAAEG,aAAa,EAAE,KAAK;iBAAE;gBAC9CP,KAAK,EAAEA,KAAK;gBACZZ,IAAI,EAAE8B,OAAO;aACd,CAAA;SACF;QAED,OAAO5B,KAAK,CAAA;KACb;IAED,IAAIC,MAAM,CAACC,IAAI,KAAK,cAAc,EAAE;QAClC,MAAM,EAAEuB,UAAU,CAAA,EAAEJ,YAAY,CAAA,EAAEX,KAAK,CAAA,EAAE,GAAGT,MAAM,CAACG,OAAO;QAC1D,IAAIe,IAAI,CAACC,SAAS,CAACC,YAAY,CAAC,KAAKF,IAAI,CAACC,SAAS,CAACpB,KAAK,CAACF,IAAI,CAAC,EAAE;YAC/D,6BAA6B;YAC7B+B,OAAO,CAACC,GAAG,CAAC,eAAe,CAAC;YAC5B,OAAO;gBACLtB,YAAY,EAAER,KAAK,CAACQ,YAAY;gBAChCC,OAAO,EAAET,KAAK,CAACS,OAAO;gBACtBX,IAAI,EAAEE,KAAK,CAACF,IAAI;gBAChBY,KAAK,EAAEV,KAAK,CAACU,KAAK;aACnB,CAAA;SACF;QAED,4DAA4D;QAC5D,IAAI,OAAOe,UAAU,KAAK,QAAQ,EAAE;YAClC,OAAO;gBACLjB,YAAY,EAAEiB,UAAU;gBACxBhB,OAAO,EAAE;oBAAEK,WAAW,EAAE,IAAI;oBAAEG,aAAa,EAAE,IAAI;iBAAE;gBACnDP,KAAK,EAAEV,KAAK,CAACU,KAAK;gBAClBZ,IAAI,EAAEE,KAAK,CAACF,IAAI;aACjB,CAAA;SACF;QAED,6CAA6C;QAC7C,MAAM5C,cAAc,GAAGuE,UAAU,CAAC,CAAC,CAAC;QAEpC,mFAAmF;QACnF,MAAME,QAAQ,GAAGzE,cAAc,CAACkB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC5C,MAAM,CAACqB,SAAS,CAAC,GAAGvC,cAAc,CAACkB,KAAK,CAAC,CAAC,CAAC,CAAC;QAE5C,MAAMwD,OAAO,GAAGrC,0BAA0B,CACxC,kBAAkB;QAClB;YAAC,EAAE;eAAKoC,QAAQ;SAAC,EACjB3B,KAAK,CAACF,IAAI,EACVL,SAAS,CACV;QAED1C,2BAA2B,CAAC2D,KAAK,EAAEV,KAAK,CAACU,KAAK,EAAExD,cAAc,CAAC;QAE/D,OAAO;YACLsD,YAAY,EAAER,KAAK,CAACQ,YAAY;YAChCC,OAAO,EAAET,KAAK,CAACS,OAAO;YACtBX,IAAI,EAAE8B,OAAO;YACblB,KAAK,EAAEA,KAAK;SACb,CAAA;KACF;IAED,OAAOV,KAAK,CAAA;CACb"}